<template>
  <div class='popup' @click='close'>
    <div class="loadPost">
      <header>
        <span>Добавить фото</span>
        <span class="icon-cross-out close" @click='close'></span>
      </header>
      <main>
        <div class="loadPost__img">
          <svg viewBox="0 0 159 135" fill="none" xmlns="http://www.w3.org/2000/svg">
          <mask id="mask">
            <path d="M135.084 42.8665C133.687 19.0429 114.027 0 90.3226 0C75.9331 0 61.9994 7.04912 53.3657 18.5506C53.1696 18.4474 52.9603 18.3785 52.7615 18.2806C52.2368 18.0265 51.7042 17.7829 51.1583 17.5685C50.8535 17.4494 50.5488 17.3409 50.2414 17.2324C49.7061 17.0444 49.1655 16.8803 48.6116 16.7294C48.3042 16.6474 47.9995 16.5626 47.6868 16.4912C47.0932 16.3562 46.489 16.2529 45.8768 16.1629C45.6065 16.1232 45.3415 16.0703 45.0686 16.0385C44.194 15.9432 43.3036 15.8824 42.4 15.8824C29.2507 15.8824 18.55 26.5685 18.55 39.7059C18.55 40.0474 18.5686 40.3809 18.5924 40.7144C7.57105 46.7153 0 59.2915 0 71.8782C0 90.6274 15.2693 105.882 34.0393 105.882H47.7C49.1628 105.882 50.35 104.699 50.35 103.235C50.35 101.771 49.1628 100.588 47.7 100.588H34.0393C18.1923 100.588 5.3 87.7103 5.3 71.8782C5.3 60.8824 12.4683 49.4682 22.3448 44.7379L23.85 44.0206V42.3529C23.85 42.0274 23.8712 41.6938 23.8898 41.3603L23.9136 40.8971L23.8818 40.3994C23.8686 40.1691 23.85 39.9388 23.85 39.7059C23.85 29.4909 32.171 21.1765 42.4 21.1765C43.2189 21.1765 44.0271 21.2479 44.8301 21.3538C45.0368 21.3803 45.2408 21.4147 45.4449 21.4491C46.1551 21.5656 46.8547 21.7191 47.5437 21.9176C47.6338 21.9441 47.7265 21.96 47.8139 21.9865C48.5718 22.2168 49.3112 22.5106 50.0347 22.8388C50.2175 22.9209 50.3977 23.0109 50.5779 23.1009C51.2192 23.4159 51.8472 23.7653 52.4515 24.1571C57.558 27.4632 60.95 33.1915 60.95 39.7059C60.95 41.1697 62.1372 42.3529 63.6 42.3529C65.0628 42.3529 66.25 41.1697 66.25 39.7059C66.25 32.4159 62.9481 25.8909 57.77 21.5179C65.3649 11.5915 77.8782 5.29412 90.3226 5.29412C110.844 5.29412 127.894 21.5338 129.67 42.0538C126.962 41.8632 122.904 41.7653 118.85 42.3847C117.403 42.6044 116.409 43.9544 116.629 45.3997C116.828 46.71 117.957 47.6497 119.245 47.6497C119.377 47.6497 119.512 47.6391 119.648 47.6179C125.541 46.7285 131.686 47.5624 132.06 47.6126C144.398 49.9553 153.7 61.3085 153.7 74.0435C153.7 88.6791 141.778 100.588 127.126 100.588H116.6C115.137 100.588 113.95 101.771 113.95 103.235C113.95 104.699 115.137 105.882 116.6 105.882H127.126C144.701 105.882 159 91.5988 159 74.0435C159 59.5138 148.858 46.4824 135.084 42.8665Z" fill="#DBDBDB"/>
            <path d="M84.0262 69.6017C83.7824 69.3555 83.4882 69.1623 83.1623 69.0273C82.5157 68.7599 81.7843 68.7599 81.1377 69.0273C80.8117 69.1623 80.5202 69.3555 80.2738 69.6017L59.0764 90.7755C58.0403 91.8105 58.0403 93.4835 59.0764 94.5185C59.5932 95.0347 60.2716 95.2941 60.95 95.2941C61.6284 95.2941 62.3068 95.0347 62.8235 94.5185L79.5 77.8605V132.353C79.5 133.817 80.6872 135 82.15 135C83.6128 135 84.8 133.817 84.8 132.353V77.8605L101.476 94.5185C101.993 95.0347 102.672 95.2941 103.35 95.2941C104.028 95.2941 104.707 95.0347 105.224 94.5185C106.26 93.4835 106.26 91.8105 105.224 90.7755L84.0262 69.6017Z" fill="#DBDBDB"/>
          </mask>
            <path d="M135.084 42.8665C133.687 19.0429 114.027 0 90.3226 0C75.9331 0 61.9994 7.04912 53.3657 18.5506C53.1696 18.4474 52.9603 18.3785 52.7615 18.2806C52.2368 18.0265 51.7042 17.7829 51.1583 17.5685C50.8535 17.4494 50.5488 17.3409 50.2414 17.2324C49.7061 17.0444 49.1655 16.8803 48.6116 16.7294C48.3042 16.6474 47.9995 16.5626 47.6868 16.4912C47.0932 16.3562 46.489 16.2529 45.8768 16.1629C45.6065 16.1232 45.3415 16.0703 45.0686 16.0385C44.194 15.9432 43.3036 15.8824 42.4 15.8824C29.2507 15.8824 18.55 26.5685 18.55 39.7059C18.55 40.0474 18.5686 40.3809 18.5924 40.7144C7.57105 46.7153 0 59.2915 0 71.8782C0 90.6274 15.2693 105.882 34.0393 105.882H47.7C49.1628 105.882 50.35 104.699 50.35 103.235C50.35 101.771 49.1628 100.588 47.7 100.588H34.0393C18.1923 100.588 5.3 87.7103 5.3 71.8782C5.3 60.8824 12.4683 49.4682 22.3448 44.7379L23.85 44.0206V42.3529C23.85 42.0274 23.8712 41.6938 23.8898 41.3603L23.9136 40.8971L23.8818 40.3994C23.8686 40.1691 23.85 39.9388 23.85 39.7059C23.85 29.4909 32.171 21.1765 42.4 21.1765C43.2189 21.1765 44.0271 21.2479 44.8301 21.3538C45.0368 21.3803 45.2408 21.4147 45.4449 21.4491C46.1551 21.5656 46.8547 21.7191 47.5437 21.9176C47.6338 21.9441 47.7265 21.96 47.8139 21.9865C48.5718 22.2168 49.3112 22.5106 50.0347 22.8388C50.2175 22.9209 50.3977 23.0109 50.5779 23.1009C51.2192 23.4159 51.8472 23.7653 52.4515 24.1571C57.558 27.4632 60.95 33.1915 60.95 39.7059C60.95 41.1697 62.1372 42.3529 63.6 42.3529C65.0628 42.3529 66.25 41.1697 66.25 39.7059C66.25 32.4159 62.9481 25.8909 57.77 21.5179C65.3649 11.5915 77.8782 5.29412 90.3226 5.29412C110.844 5.29412 127.894 21.5338 129.67 42.0538C126.962 41.8632 122.904 41.7653 118.85 42.3847C117.403 42.6044 116.409 43.9544 116.629 45.3997C116.828 46.71 117.957 47.6497 119.245 47.6497C119.377 47.6497 119.512 47.6391 119.648 47.6179C125.541 46.7285 131.686 47.5624 132.06 47.6126C144.398 49.9553 153.7 61.3085 153.7 74.0435C153.7 88.6791 141.778 100.588 127.126 100.588H116.6C115.137 100.588 113.95 101.771 113.95 103.235C113.95 104.699 115.137 105.882 116.6 105.882H127.126C144.701 105.882 159 91.5988 159 74.0435C159 59.5138 148.858 46.4824 135.084 42.8665Z" fill="#DBDBDB"/>
            <path d="M84.0262 69.6017C83.7824 69.3555 83.4882 69.1623 83.1623 69.0273C82.5157 68.7599 81.7843 68.7599 81.1377 69.0273C80.8117 69.1623 80.5202 69.3555 80.2738 69.6017L59.0764 90.7755C58.0403 91.8105 58.0403 93.4835 59.0764 94.5185C59.5932 95.0347 60.2716 95.2941 60.95 95.2941C61.6284 95.2941 62.3068 95.0347 62.8235 94.5185L79.5 77.8605V132.353C79.5 133.817 80.6872 135 82.15 135C83.6128 135 84.8 133.817 84.8 132.353V77.8605L101.476 94.5185C101.993 95.0347 102.672 95.2941 103.35 95.2941C104.028 95.2941 104.707 95.0347 105.224 94.5185C106.26 93.4835 106.26 91.8105 105.224 90.7755L84.0262 69.6017Z" fill="#DBDBDB"/>
            <rect width='100' height='100' fill='#000' mask='url(#mask)' :style='{height: loaded + "%"}'/>
          </svg>
        </div>
        <span>Перенесите сюда ваши секси фоточки</span>
        <select-btn text='Выбрать с пк' @click='open'/>
        <input type="file" ref='file' @change='onload'>
      </main>
    </div>
  </div>
</template>

<script>
import selectBtn from './Buttons/select-button'
export default {
  name: 'new-post-popup',
  components: {selectBtn},
  data () {
    return {
      loaded: 0
    }
  },
  methods: {
    open () {
      this.$refs['file'].click()
    },
    close (e) {
      if (e.target === e.currentTarget) this.$emit('fail')
    },
    onload (e) {
      const f = e.target.files[0]
      const reader = new FileReader()
      reader.readAsDataURL(f)
      reader.onload = (e) => {
        setTimeout(() => {
          this.$emit('loaded', {
            source: e.target.result
          })
        }, 1000)
      }
      reader.onloadstart = (e) => {
        this.loaded = 0
        if (e.total / 1000000 > 30 || !f.type.match('image.*')) {
          reader.abort()
        }
      }
      reader.onprogress = (result) => {
        this.loaded = result.loaded / result.total * 100
      }
    }
  }
}
</script>

<style scoped>
  .popup {
    z-index: 99;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,.4);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .loadPost {
    background: #fff;
    border-radius: 5px 5px 0 0;
  }
  header {
    position: relative;
    text-align: center;
    padding: 15px 5px;
    border-bottom: 1px solid #E8E8E8;
    font-weight: bold;
    font-size: 15px;
  }
  .close {
    position: absolute;
    top: 5px;
    right: 5px;
    font-size: 18px;
  }
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 69px 51px 38px 51px;
  }
  main span {
    color: #919191;
    display: inline-block;
    margin-bottom: 43px;
    font-weight: bold;
    font-size: 15px;
  }
  input {
    display: none;
  }
  .loadPost__img {
    margin-bottom: 20px;
    text-align: center;
  }
  svg {
    width: 50%;
  }
  rect {
    width: 100%;
    height: 0;
    transition: all .2s;
    fill: rgba(0,0,0,.5)
  }
</style>
